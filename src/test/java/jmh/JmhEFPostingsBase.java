package jmh;

import java.io.IOException;

import org.apache.lucene.codecs.lucene90.EFEncoder;
import org.apache.lucene.codecs.lucene90.EFPostingsEnum;
import org.apache.lucene.codecs.lucene90.Lucene90PostingsFormat.IntBlockTermState;
import org.apache.lucene.store.ByteBuffersDataOutput;
import org.apache.lucene.store.ByteBuffersIndexInput;
import org.apache.lucene.store.ByteBuffersIndexOutput;
import org.apache.lucene.store.IndexOutput;
import org.openjdk.jmh.annotations.Scope;
import org.openjdk.jmh.annotations.Setup;
import org.openjdk.jmh.annotations.State;

@State(Scope.Benchmark)
public abstract class JmhEFPostingsBase {

	protected static final IntBlockTermState termState = new IntBlockTermState();
	protected EFPostingsEnum postings;
	protected ByteBuffersIndexInput ixIn;

	@Setup
	public void createEncodedData() throws IOException {
		int[] values = { 2, 9, 18, 20, 34, 35, 36, 37, 41, 42, 43, 46, 54, 56, 57, 64, 65, 66, 78, 80, 87, 89, 94, 104,
				106, 129, 137, 138, 139, 140, 141, 147, 152, 208, 214, 246, 251, 255, 262, 267, 277, 289, 302, 306, 307,
				308, 311, 312, 328, 331, 390, 412, 421, 477, 585, 610, 683, 688, 788, 797, 845, 849, 929, 953, 955, 959,
				967, 981, 982, 983, 984, 985, 986, 987, 988, 989, 990, 991, 998, 1013, 1018, 1020, 1057, 1075, 1107,
				1108, 1109, 1148, 1149, 1256, 1269, 1279, 1304, 1305, 1307, 1313, 1327, 1349, 1350, 1351, 1357, 1365,
				1378, 1397, 1409, 1430, 1431, 1432, 1504, 1506, 1543, 1583, 1601, 1602, 1603, 1625, 1650, 1662, 1673,
				1674, 1675, 1688, 1690, 1692, 1704, 1728, 1738, 1739, 1742, 1745, 1793, 1804, 1808, 1813, 1814, 1815,
				1819, 1820, 1823, 1895, 1905, 1913, 1938, 1945, 1963, 2016, 2017, 2030, 2041, 2044, 2057, 2076, 2080,
				2082, 2088, 2092, 2094, 2097, 2098, 2104, 2106, 2108, 2109, 2110, 2114, 2116, 2117, 2118, 2120, 2122,
				2123, 2132, 2145, 2146, 2147, 2148, 2149, 2164, 2166, 2167, 2173, 2191, 2248, 2252, 2293, 2304, 2306,
				2309, 2315, 2324, 2325, 2333, 2341, 2348, 2361, 2378, 2400, 2407, 2440, 2447, 2448, 2451, 2463, 2466,
				2472, 2489, 2490, 2503, 2505, 2507, 2509, 2510, 2511, 2512, 2514, 2515, 2517, 2519, 2522, 2532, 2545,
				2547, 2551, 2553, 2554, 2558, 2560, 2561, 2562, 2573, 2592, 2598, 2640, 2657, 2662, 2667, 2677, 2679,
				2689, 2692, 2695, 2696, 2702, 2705, 2707, 2709, 2713, 2720, 2722, 2728, 2731, 2762, 2763, 2764, 2765,
				2785, 2827, 2828, 2837, 2856, 2859, 2875, 2896, 2897, 2899, 2914, 2918, 2920, 2942, 2943, 2966, 2983,
				2989, 2996, 3062, 3064, 3065, 3101, 3111, 3123, 3127, 3147, 3150, 3152, 3159, 3163, 3169, 3170, 3182,
				3183, 3184, 3186, 3188, 3189, 3200, 3227, 3241, 3250, 3261, 3262, 3263, 3275, 3296, 3297, 3305, 3358,
				3359, 3360, 3363, 3364, 3382, 3389, 3391, 3392, 3402, 3419, 3430, 3437, 3444, 3455, 3458, 3461, 3484,
				3503, 3514, 3534, 3555, 3556, 3560, 3580, 3593, 3609, 3611, 3619, 3621, 3627, 3638, 3648, 3654, 3660,
				3665, 3689, 3702, 3742, 3768, 3777, 3783, 3789, 3790, 3791, 3792, 3793, 3802, 3803, 3806, 3809, 3829,
				3830, 3831, 3837, 3846, 3848, 3858, 3861, 3868, 3891, 3892, 3896, 3906, 3912, 3918, 3923, 3932, 3934,
				3935, 3945, 3947, 3950, 3954, 3958, 3960, 3963, 3966, 3968, 3970, 3990, 4013, 4028, 4030, 4031, 4038,
				4054, 4055, 4095, 4097, 4098, 4101, 4107, 4114, 4130, 4131, 4132, 4133, 4136, 4137, 4151, 4156, 4157,
				4189, 4192, 4200, 4220, 4222, 4223, 4224, 4237, 4238, 4280, 4281, 4296, 4298, 4299, 4300, 4307, 4308,
				4310, 4365, 4366, 4417, 4418, 4419, 4420, 4421, 4422, 4423, 4432, 4433, 4434, 4435, 4441, 4444, 4450,
				4462, 4463, 4465, 4466, 4468, 4469, 4470, 4471, 4474, 4475, 4476, 4478, 4479, 4496, 4499, 4518, 4519,
				4521, 4526, 4527, 4529, 4530, 4536, 4666, 4686, 4698, 4719, 4777, 4794, 4799, 4800, 4802, 4803, 4804,
				4805, 4810, 4811, 4819, 4832, 4840, 4863, 4864, 4888, 4898, 4916, 4921, 4925, 4929, 4939, 4943, 4945,
				4948, 4957, 4966, 4990, 5013, 5015, 5028, 5156, 5166, 5182, 5188, 5189, 5190, 5205, 5227, 5257, 5259,
				5260, 5261, 5262, 5263, 5269, 5296, 5297, 5298, 5299, 5309, 5320, 5327, 5348, 5352, 5360, 5384, 5388,
				5389, 5415, 5422, 5423, 5424, 5475, 5476, 5477, 5478, 5479, 5506, 5525, 5526, 5534, 5590, 5603, 5653,
				5658, 5685, 5693, 5703, 5710, 5747, 5815, 5816, 5817, 5818, 5819, 5825, 5857, 5861, 5868, 5869, 5877,
				5880, 5932, 5981, 5982, 5983, 5995, 6089, 6103, 6121, 6123, 6133, 6134, 6148, 6150, 6151, 6153, 6154,
				6155, 6156, 6170, 6172, 6174, 6178, 6181, 6184, 6186, 6188, 6192, 6197, 6199, 6205, 6206, 6211, 6217,
				6218, 6220, 6221, 6222, 6224, 6227, 6228, 6231, 6232, 6238, 6241, 6242, 6411, 6428, 6429, 6430, 6440,
				6441, 6445, 6469, 6473, 6481, 6502, 6503, 6504, 6505, 6506, 6507, 6508, 6509, 6510, 6511, 6512, 6532,
				6556, 6557, 6660, 6668, 6670, 6687, 6725, 6727, 6728, 6740, 6741, 6744, 6753, 6756, 6764, 6766, 6791,
				6799, 6809, 6810, 6812, 6824, 6826, 6847, 6848, 6849, 6881, 6884, 6892, 6901, 6938, 6946, 6951, 6953,
				6955, 6960, 6974, 6977, 6978, 6979, 6980, 6981, 6982, 6985, 7001, 7002, 7016, 7018, 7019, 7027, 7043,
				7053, 7058, 7059, 7066, 7088, 7096, 7103, 7104, 7109, 7110, 7115, 7117, 7120, 7122, 7125, 7126, 7140,
				7141, 7142, 7145, 7146, 7147, 7160, 7221, 7252, 7253, 7254, 7255, 7256, 7257, 7258, 7259, 7260, 7266,
				7281, 7284, 7296, 7297, 7298, 7301, 7303, 7322, 7324, 7330, 7391, 7430, 7445, 7464, 7468, 7474, 7478,
				7509, 7510, 7514, 7539, 7540, 7575, 7614, 7677, 7678, 7679, 7680, 7681, 7682, 7692, 7696, 7701, 7712,
				7714, 7732, 7754, 7788, 7789, 7797, 7803, 7844, 7851, 7858, 7865, 7866, 7867, 7868, 7869, 7913, 7918,
				7920, 7921, 7924, 7925, 7926, 7927, 7932, 7937, 7945, 7967, 7974, 7987, 7991, 7992, 7998, 7999, 8003,
				8041, 8042, 8045, 8046, 8086, 8087, 8093, 8094, 8099, 8100, 8101, 8102, 8103, 8105, 8106, 8108, 8110,
				8111, 8112, 8114, 8115, 8116, 8117, 8118, 8171, 8200, 8227, 8248, 8437, 8478, 8508, 8530, 8533, 8536,
				8538, 8550, 8551, 8563, 8567, 8570, 8572, 8576, 8583, 8591, 8592, 8593, 8594, 8595, 8599, 8601, 8605,
				8607, 8610, 8611, 8614, 8615, 8616, 8654, 8659, 8664, 8671, 8672, 8678, 8684, 8687, 8692, 8707, 8716,
				8729, 8730, 8744, 8751, 8765, 8768, 8769, 8771, 8777, 8780, 8812, 8813, 8816, 8818, 8924, 8925, 8926,
				8992, 8996, 8999, 9002, 9007, 9015, 9032, 9040, 9041, 9046, 9050, 9057, 9064, 9071, 9112, 9118, 9119,
				9120, 9134, 9138, 9180, 9246, 9256, 9257, 9258, 9260, 9262, 9266, 9267, 9270, 9271, 9272, 9273, 9275,
				9278, 9279, 9280, 9282, 9316, 9327, 9339, 9340, 9349, 9351, 9370, 9371, 9377, 9383, 9390, 9452, 9453,
				9454, 9455, 9456, 9462, 9482, 9489, 9493, 9549, 9585, 9586, 9587, 9594, 9619, 9685, 9686, 9699, 9700,
				9701, 9704, 9705, 9708, 9759, 9804, 9806, 9819, 9820, 9854, 9855, 9859, 9864, 9866, 9868, 9883, 9886,
				9888, 9893, 9918, 9922, 9924, 9929, 9940, 9942, 9962, 9975, 9977, 9978, 9979, 9986, 9987, 9988, 9989,
				9992, 9993, 9994, 9995, 9997 };
		ByteBuffersDataOutput bbdo = new ByteBuffersDataOutput();
		try (IndexOutput out = new ByteBuffersIndexOutput(bbdo, "descr", "name")) {
			EFEncoder efEncode = new EFEncoder(out, 10_000, 1 << 29);
			for (int i : values) {
				efEncode.addDoc(i, 1);
			}
			efEncode.finish();
		}
		ixIn = new ByteBuffersIndexInput(bbdo.toDataInput(), "desc");
		termState.docFreq = values.length;
		postings = new EFPostingsEnum(ixIn, 10_000);
	}
}